app-id: io.github.bggRGjQaUbCoE.PiliPlus
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
add-extensions:
  org.freedesktop.Platform.ffmpeg-full:
    directory: lib/ffmpeg
    add-ld-path: .
command: piliplus
separate-locales: false
finish-args:
  - --share=ipc
  - --share=network
  - --socket=fallback-x11
  - --socket=wayland
  - --socket=pulseaudio
  - --device=dri
  - --own-name=com.example.piliplus
  - --talk-name=org.freedesktop.ScreenSaver
  - --talk-name=org.kde.StatusNotifierWatcher
cleanup:
  - /lib/debug
modules:
  - ../shared-modules/libayatana-appindicator/libayatana-appindicator-gtk3.json
  - name: shaderc
    buildsystem: cmake
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DSHADERC_SKIP_TESTS=ON
      - -DSHADERC_SKIP_EXAMPLES=ON
      - -DSHADERC_SKIP_EXECUTABLES=ON
    cleanup:
      - /bin
      - /include
      - /lib/*.a
      - /lib/*.la
      - /lib/cmake
      - /lib/pkgconfig
    sources:
      - type: archive
        url: https://github.com/google/shaderc/archive/refs/tags/v2025.5.tar.gz
        sha256: fca5041b1fdea6daba167b63e04e55e5059fab40828342126169336643445447
        x-checker-data:
          type: anitya
          project-id: 19047
          url-template: https://github.com/google/shaderc/archive/refs/tags/v$version.tar.gz
      - type: archive
        url: https://github.com/KhronosGroup/glslang/archive/refs/tags/16.1.0.tar.gz
        sha256: 32c605822ed63a0cdc2d24f318c3d912fa14e58573aff1d8eac0cf69f1a6b6d2
        dest: third_party/glslang
        x-checker-data:
          type: anitya
          project-id: 205796
          url-template: https://github.com/KhronosGroup/glslang/archive/refs/tags/$version.tar.gz
      - type: archive
        url: https://github.com/KhronosGroup/SPIRV-Headers/archive/refs/tags/vulkan-sdk-1.4.328.1.tar.gz
        sha256: 602364ab7bf404a7f352df7da5c645f1c4558a9c92616f8ee33422b04d5e35b7
        dest: third_party/spirv-headers
        # x-checker-data:
        #   type: anitya
        #   project-id: 14894
        #   url-template: https://github.com/KhronosGroup/SPIRV-Headers/archive/refs/tags/$version.tar.gz
      - type: archive
        url: https://github.com/KhronosGroup/SPIRV-Tools/archive/refs/tags/v2025.4.tar.gz
        sha256: d256aa82de849bdce4b05060081dadcc9145c2173a056e8531f649f8975e582e
        dest: third_party/spirv-tools
        x-checker-data:
          type: anitya
          project-id: 14894
          url-template: https://github.com/KhronosGroup/SPIRV-Tools/archive/refs/tags/v$version.tar.gz
  - name: hwdata
    buildsystem: autotools
    cleanup:
      - /share/pkgconfig
    sources:
      - type: archive
        url: https://github.com/vcrhonek/hwdata/archive/refs/tags/v0.403.tar.gz
        sha256: 77d0a69e5558d16d33bbb510a09093deaf11c882baf9ef6ec5f18a8ef96e2c13
        x-checker-data:
          type: anitya
          project-id: 5387
          url-template: https://github.com/vcrhonek/hwdata/archive/refs/tags/v$version.tar.gz
  - name: libass
    buildsystem: meson
    cleanup:
      - /include
      - /lib/pkgconfig
    sources:
      - type: archive
        url: https://github.com/libass/libass/releases/download/0.17.4/libass-0.17.4.tar.xz
        sha256: 78f1179b838d025e9c26e8fef33f8092f65611444ffa1bfc0cfac6a33511a05a
        x-checker-data:
          type: anitya
          project-id: 1560
          url-template: https://github.com/libass/libass/releases/download/$version/libass-$version.tar.xz
  - name: libdisplay-info
    buildsystem: meson
    cleanup:
      - /include
      - /lib/pkgconfig
    sources:
      - type: archive
        url: https://gitlab.freedesktop.org/emersion/libdisplay-info/-/archive/0.3.0/libdisplay-info-0.3.0.tar.gz
        sha256: 2b467e3336aec63819d6aca28d7310d3dc7415b2b3a3c3a5aec9d3727053c078
        x-checker-data:
          type: anitya
          project-id: 326668
          url-template: https://gitlab.freedesktop.org/emersion/libdisplay-info/-/archive/$version/libdisplay-info-$version.tar.gz
  - name: libplacebo
    buildsystem: meson
    config-opts:
      - -Ddemos=False
    cleanup:
      - /include
      - /lib/pkgconfig
    sources:
      - type: git
        url: https://github.com/haasn/libplacebo.git
        tag: v7.351.0
        commit: 3188549fba13bbdf3a5a98de2a38c2e71f04e21e
        x-checker-data:
          type: json
          url: https://api.github.com/repos/haasn/libplacebo/releases/latest
          tag-query: .tag_name
      # Temporary cheery-picked fix for Python 3.14, should be removed after new release
      - type: patch
        path: patches/libplacebo/12509c0f1ee8c22ae163017f0a5e7b8a9d983a17.patch
  - name: libXpresent
    buildsystem: meson
    cleanup:
      - /include
      - /lib/pkgconfig
      - /share/man
    sources:
      - type: archive
        url: https://xorg.freedesktop.org/archive/individual/lib/libXpresent-1.0.2.tar.xz
        sha256: 4e5b21b4812206a4b223013606ae31170502c1043038777a1ef8f70c09d37602
        x-checker-data:
          type: anitya
          project-id: 17166
          url-template: https://xorg.freedesktop.org/archive/individual/lib/libXpresent-$version.tar.xz
  - name: libmpv
    cleanup:
      - /include
      - /lib/pkgconfig
      - /share/bash-completion
      - /share/zsh
    buildsystem: meson
    config-opts:
      - -Dlibmpv=true
      - -Dcplayer=false
      - -Dbuild-date=false
    sources:
      - type: archive
        url: https://github.com/mpv-player/mpv/archive/v0.41.0.tar.gz
        sha256: ee21092a5ee427353392360929dc64645c54479aefdb5babc5cfbb5fad626209
        x-checker-data:
          type: anitya
          project-id: 5348
          url-template: https://github.com/mpv-player/mpv/archive/v$version.tar.gz
  - name: piliplus
    buildsystem: simple
    build-commands:
      - mkdir -p /app/lib/ffmpeg
      - install -Dm644 data/flutter_assets/assets/images/logo/logo.png /app/share/icons/hicolor/512x512/apps/$FLATPAK_ID.png
      - cp -r . /app/share/piliplus
      - mkdir -p /app/bin
      - ln -s /app/share/piliplus/piliplus /app/bin/piliplus
      - install -Dm644 io.github.bggRGjQaUbCoE.PiliPlus.desktop -t /app/share/applications/
      - install -Dm644 io.github.bggRGjQaUbCoE.PiliPlus.metainfo.xml -t /app/share/metainfo/
    sources:
      #- type: archive
      #  only-arches:
      #    - aarch64
      #  url: https://github.com/bggRGjQaUbCoE/PiliPlus/releases/download/1.1.4.15/PiliPlus_linux_1.1.4%2B4285_arm64.tar.gz
      #  sha256: 7f9c266ca7d0a0d41d113c229f21e5fa12c2ba38031bf4d714b5ae853befb961
      #  x-checker-data:
      #    type: json
      #    url: https://api.github.com/repos/bggRGjQaUbCoE/PiliPlus/releases/latest
      #    version-query: .tag_name
      #    url-query: .assets[] | select(.name | test("PiliPlus_linux_.+_arm64\\.tar\\.gz"))
      #      | .browser_download_url
      - type: archive
        only-arches:
          - x86_64
        url: https://github.com/bggRGjQaUbCoE/PiliPlus/releases/download/1.1.5.3/PiliPlus_linux_1.1.5%2B4526_amd64.tar.gz
        sha256: 118e10fa34166d7427b80171a2ed9f77907b8c50fb4687f5aa6ff634200d6ee8
        x-checker-data:
          type: json
          url: https://api.github.com/repos/bggRGjQaUbCoE/PiliPlus/releases/latest
          version-query: .tag_name
          url-query: .assets[] | select(.name | test("PiliPlus_linux_.+_amd64\\.tar\\.gz"))
            | .browser_download_url
      - type: file
        path: io.github.bggRGjQaUbCoE.PiliPlus.desktop
      - type: file
        path: io.github.bggRGjQaUbCoE.PiliPlus.metainfo.xml
